define(["angular"],function(e){"use strict";function t(e,t,r,n,c,i){e.currentUser.isAuth&&(e.createNewProject=function(o){o.owner=e.currentUser._id,o.accessKey="#"+r.btoa(e.currentUser._id+o.weddingDate+o.wedBudget),o.weddingDate=i._dateStringToObject(o.weddingDate),o.created=new Date,c._ajaxRequest("POST",null,o,null).then(function(t){e.newProject={},e.$emit("projectsListChange");var r={projectId:t._id,qty:t.smsCollection.length};e.$emit("smsQty",r),_env()._dev?n.success("НОВЫЙ ПРОЕКТ СВАДЬБЫ "+t.fianceName+" и "+t.fianceeName+" СОЗДАН УСПЕШНО!"):n.success("OK")}).catch(function(e){n.error("ERROR: Create New Project ops failed"),t.warn("ERROR: Create New Project ops failed",e)})})}function r(e,t,r,n,c){function i(){e.editProject.budget.budgetNat=e.currentProject.wedBudget*e.editProject.budget.currency}e.currentUser.isAuth&&(e.editProject={},e.$on("editProject",function(o,d){n._ajaxRequest("GET",d.id,null,null).then(function(t){t.weddingDate=c._objectToDateString(t.weddingDate),e.editProject=t,i()}).catch(function(e){r.error("ERROR: GET init data failed"),t.warn("ERROR: GET init data failed",e)})}),e.editProjectApply=function(t){e.deleteProjectTrigger=!1,t.weddingDate.length<12&&(t.weddingDate=c._dateStringToObject(t.weddingDate)),i(),n._ajaxRequest("PUT",null,t,null).then(function(t){_env()._dev?r.success("PROJECT EDITED WITH SUCCESS"):r.success("OK"),e.$emit("projectsListChange")},function(e){throw r.error("ERROR: project Edit & AJAX PUT failed"),new Error("ERROR: project Edit & AJAX PUT failed"+e)})},e.deleteProject=function(c){var i={projectId:c,qty:"remove"};e.$emit("smsQty",i),n._ajaxRequest("DELETE",c,null,null).then(function(t){_env()._dev&&r.warning("PROJECT WAS DELETED"),e.$emit("projectsListChange"),e.deleteProjectTrigger=!1}).catch(function(e){r.error("ERROR: DELETE PROJECT AJAX failed"),t.warn("ERROR: DELETE PROJECT AJAX failed",e)})})}t.$inject=["$scope","$log","$window","toastr","ResourceService","AppService"],r.$inject=["$scope","$log","toastr","ResourceService","AppService"];var n=e.module("newProjectCtrlModule",["wedServices"]);return n.controller("newProjectCtrl",t),n.controller("editProjectCtrl",r),n});
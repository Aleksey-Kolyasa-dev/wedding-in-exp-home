define(["angular"],function(e){"use strict";function t(t,r,n,o){function a(){t.total={planUsd:0,planNat:0,paidUsd:0,paidNat:0,paidTotalUsd:0,paidTotalNat:0,restTotalUsd:0,restTotalNat:0},e.forEach(t.items,function(e){e.usd&&(t.total.planUsd+=e.toPay,t.total.planNat=t.total.planUsd*t.currentProject.budget.currency,t.total.paidUsd+=e.paid,t.total.paidNat=t.total.paidUsd*t.currentProject.budget.currency),e.usd||(t.total.planNat+=e.toPay,t.total.planUsd=t.total.planNat/t.currentProject.budget.currency,t.total.paidNat+=e.paid,t.total.paidUsd=t.total.paidNat/t.currentProject.budget.currency)}),t.total.paidTotalUsd+=t.total.paidUsd,t.total.paidTotalNat=t.total.paidTotalUsd*t.currentProject.budget.currency,t.total.restTotalUsd=t.total.planUsd-t.total.paidTotalUsd,t.total.restTotalNat=t.total.restTotalUsd*t.currentProject.budget.currency,t.currentProject[t.conf.mainProp].total=t.total}t.conf={mainProp:"marriage",parent:"marriage",msgNameBg:"MARRIAGE",msgNameSm:"Marriage",title:"ВЕНЧАНИЕ",ttlBy:"ВЕНЧАНИЮ",expTableTitle:"ПО ВЕНЧАНИЮ",buttons:[],views:["marriage"],get addForm(){return"addNew"+this.msgNameSm+"ExpenseForm"},get editForm(){return"edit"+this.msgNameSm+"ExpenseForm"}},t.itemToEdit={},t.newItem={},t.removeTrigger={},t.removeTrigger.status=!1,t.$watch("currentProject.budget.currency",function(){t.currentProject[t.conf.mainProp].expCollection.length&&(a(),_env()._dev&&r.log("Update PROJECT by "+t.conf.msgNameBg+": reason - CURRENCY change EVENT"))}),t.items=t.currentProject[t.conf.mainProp].expCollection,t.total=t.currentProject[t.conf.mainProp].total,t.notes=t.currentProject[t.conf.mainProp+"Notes"],t.addNewExpenseItem=function(i){if(!(""!=i.name&&e.isNumber(i.tariff)&&e.isNumber(i.multiplier)&&e.isNumber(i.paid)))throw n.error("ERROR: "+t.conf.msgNameSm+" expense input check failed"),new Error("ERROR: "+t.conf.msgNameSm+" expense input check failed");""!=i.unit&&null!=i.unit||(i.unit="не указано"),i.multiplier<0&&(i.multiplier=1),0==i.multiplier&&(i.multiplier=1),i.tariff<0&&(i.tariff*=-1),i.paid<0&&(i.paid*=-1),i.toPay=i.tariff*i.multiplier,i.rest=i.toPay-i.paid,i.usd?i.money="USD":i.money=t.currentProject.budget.nationalMoney,t.currentProject[t.conf.mainProp].expCollection.push(i),a(),_env()._dev&&r.log("Update PROJECT by "+t.conf.msgNameBg+": reason - ADD "+t.conf.msgNameBg+" EXP EVENT ");var c={_id:t.currentProject._id,key:t.conf.mainProp,keyURL:"/"+t.conf.mainProp+"DataSave"};c[t.conf.mainProp]=t.currentProject[t.conf.mainProp],o._ajaxRequest("PUT",null,c,c.keyURL).then(function(e){t.newItem={},_env()._dev?n.success("New "+t.conf.msgNameSm+" Item created!"):n.success("OK")},function(e){throw n.error("ERROR: New "+t.conf.msgNameSm+" Item AJAX failed"),new Error("ERROR: New "+t.conf.msgNameSm+" Item AJAX failed")}).catch(function(e){n.error("ERROR: New "+t.conf.msgNameSm+" Item AJAX failed"),r.error("ERROR: New "+t.conf.msgNameSm+" Item AJAX failed",e)})},t.editExpenseItem=function(e){t.itemToEdit=t.items[e],t.removeTrigger.status=!1},t.editExpenseItemSave=function(i){if(!(""!=i.name&&e.isNumber(i.tariff)&&e.isNumber(i.multiplier)&&e.isNumber(i.paid)))throw n.error("ERROR: "+t.conf.msgNameBg+" expense input check failed"),new Error("ERROR: "+t.conf.msgNameBg+" expense input check failed");""!=i.unit&&null!=i.unit||(i.unit="не указано"),i.multiplier<0&&(i.multiplier=1),0==i.multiplier&&(i.multiplier=1),i.tariff<0&&(i.tariff*=-1),i.paid<0&&(i.paid*=-1),i.toPay=i.tariff*i.multiplier,i.rest=i.toPay-i.paid,i.usd?i.money="USD":i.money=t.currentProject.budget.nationalMoney,a(),_env()._dev&&r.log("update PROJECT by "+t.conf.msgNameBg+": reason - EDIT "+t.conf.msgNameBg+" EXP EVENT ");var c={_id:t.currentProject._id,key:t.conf.mainProp,keyURL:"/"+t.conf.mainProp+"DataSave"};c[t.conf.mainProp]=t.currentProject[t.conf.mainProp],o._ajaxRequest("PUT",null,c,c.keyURL).then(function(e){t.itemToEdit={},_env()._dev?n.success(t.conf.msgNameBg+" Expense Item Edited!"):n.success("OK")},function(e){throw n.error("ERROR: "+t.conf.msgNameBg+" Expense Item EditAJAX failed"),new Error("ERROR: "+t.conf.msgNameBg+"Expense Item Edit AJAX failed")}).catch(function(e){n.error("ERROR: "+t.conf.msgNameBg+" Expense Item Edit AJAX failed"),r.error("ERROR: "+t.conf.msgNameBg+" Expense Item Edit AJAX failed")})},t.deleteExpenseItem=function(e){t.currentProject[t.conf.mainProp].expCollection.splice(e,1),a(),_env()._dev&&r.log("Update PROJECT by "+t.conf.msgNameBg+": reason - REMOVE "+t.conf.msgNameBg+" EXP EVENT ");var i={_id:t.currentProject._id,key:t.conf.mainProp,keyURL:"/"+t.conf.mainProp+"DataSave"};i[t.conf.mainProp]=t.currentProject[t.conf.mainProp],o._ajaxRequest("PUT",null,i,i.keyURL).then(function(e){_env()._dev?n.info(t.conf.msgNameBg+" Expense Item removed"):n.info("OK")},function(e){throw n.error("ERROR: "+t.conf.msgNameBg+" Expense Item AJAX failed"),new Error("ERROR: "+t.conf.msgNameBg+" Expense Item AJAX failed")}).catch(function(e){n.error("ERROR: "+t.conf.msgNameBg+" Expense Item Edit AJAX failed"),r.error("ERROR: "+t.conf.msgNameBg+" Expense Item Edit AJAX failed",e)})},t.notesFilter=function(e){if(null==e)return"";var t=e.split("*");return""==t[0]&&t.splice(0,1),t},t.noteSave=function(){var e={_id:t.currentProject._id,key:t.conf.mainProp+"Notes",keyURL:"/"+t.conf.mainProp+"Notes"};e[t.conf.mainProp+"Notes"]=t.currentProject[t.conf.mainProp+"Notes"],o._ajaxRequest("PUT",null,e,e.keyURL).then(function(e){_env()._dev?n.info(t.conf.msgNameBg+" Notes are saved!"):n.info("OK")},function(e){throw n.error("ERROR: "+t.conf.msgNameBg+" Notes AJAX failed"),new Error("ERROR: "+t.conf.msgNameBg+" Notes AJAX failed")}).catch(function(e){n.error("ERROR: "+t.conf.msgNameBg+" Notes AJAX failed"),r.error("ERROR: "+t.conf.msgNameBg+" Notes AJAX failed",e)})}}t.$inject=["$scope","$log","toastr","ResourceService"];var r=e.module("marriageCtrlModule",["wedServices"]);return r.controller("marriageMainCtrl",t),r});